# üèÄ Faster R-CNN (ResNet-50 + FPN) ‚Äî Basketball Foul Detector

![Python](https://img.shields.io/badge/Python-3.8%2B-blue.svg)
![PyTorch](https://img.shields.io/badge/PyTorch-1.13%2B-red.svg)
![TorchMetrics](https://img.shields.io/badge/TorchMetrics-0.11-green.svg)
![OpenCV](https://img.shields.io/badge/OpenCV-4.x-yellow.svg)
![Kaggle API](https://img.shields.io/badge/Kaggle-API-orange.svg)
![Colab](https://img.shields.io/badge/Google%20Colab-compatible-brightgreen.svg)
![License](https://img.shields.io/badge/License-MIT-lightgrey.svg)

---

## üìñ Overview
–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–æ—É—Ç–±—É–∫, –∫–æ—Ç–æ—Ä—ã–π –æ–±—É—á–∞–µ—Ç **–æ–¥–Ω–æ–∫–∞–¥—Ä–æ–≤—ã–π** –¥–µ—Ç–µ–∫—Ç–æ—Ä –±–∞—Å–∫–µ—Ç–±–æ–ª—å–Ω—ã—Ö —Ñ–æ–ª–æ–≤.  
–í –æ—Å–Ω–æ–≤–µ ‚Äî **Faster R-CNN** —Å **ResNet-50 + Feature Pyramid Network**, –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–π –Ω–∞ COCO –∏ –¥–æ–æ–±—É—á–µ–Ω–Ω—ã–π –Ω–∞ —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö –∫–∞–¥—Ä–∞—Ö –∏–∑ Label Studio.

---

## üéØ TL;DR ‚Äì —Ç–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã  
| –ú–µ—Ç—Ä–∏–∫–∞ (val) | –ó–Ω–∞—á–µ–Ω–∏–µ * |
|---------------|-----------|
| **mAP @ 0.50** | **0.0105** |
| AR @ 10        | 0.0749 |

\* –ø–æ–ª—É—á–µ–Ω–æ –ø–æ—Å–ª–µ 30 —ç–ø–æ—Ö –Ω–∞ GPU A100 40 GB.


---

## üì¶ Dataset

| –ò—Å—Ç–æ—á–Ω–∏–∫                          | –†–∞–∑–º–µ—Ä | –°—Å—ã–ª–∫–∞                                                                                                                     |
| --------------------------------- | -----: | -------------------------------------------------------------------------------------------------------------------------- |
| Kaggle: **Foul Detection (test)** | 1.3 GB | [https://www.kaggle.com/datasets/sesmlhs/foul-detection-test](https://www.kaggle.com/datasets/sesmlhs/foul-detection-test) |

---

## ‚öôÔ∏è –ù–æ—É—Ç–±—É–∫ –ø–æ –±–ª–æ–∫–∞–º

| –ë–ª–æ–∫      | –ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞                                                                                                                    | Why / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                         |
| --------- | ---------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------- |
| **BLK-1** | –£—Å—Ç–∞–Ω–æ–≤–∫–∞, –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Drive, `kaggle datasets download`                                                                          | –ß–µ–∫-–ø–æ–π–Ω—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ Drive              |
| **BLK-2** | –ß—Ç–µ–Ω–∏–µ JSON ‚Üí `{frame : bbox}`                                                                                                     | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∏ –∏ –ø—É—Å—Ç—ã–µ bbox       |
| **BLK-3** | Stratified split 80/20, incremental-training –ª–æ–≥                                                                                   | `seen_videos.txt` ‚Äî –Ω–µ –ø–µ—Ä–µ–æ–±—É—á–∞—Ç—å —Å—Ç–∞—Ä–æ–µ |
| **BLK-4** | `FrameDataset`: –±–µ—Ä—ë–º **—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–∞–¥—Ä**, resize 512, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è, –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ (ColorJitter, flip, blur, rotate) + safe-wrapper | –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–∞–¥—Ä ‚âà –≤–µ—Ä–æ—è—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ñ–æ–ª–∞  |
| **BLK-5** | –°–æ–∑–¥–∞–Ω–∏–µ Faster R-CNN ResNet-50-FPN, –∑–∞–º–µ–Ω–∞ head‚Üí2 –∫–ª–∞—Å—Å–∞                                                                          | ¬´—Ñ–æ–Ω¬ª / ¬´foul¬ª                            |
| **BLK-6** | EMA-update, –º–µ—Ç—Ä–∏–∫–∏, LR-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏                                                                                               | ‚Äî                                         |
| **BLK-7** | –û–±—É—á–µ–Ω–∏–µ: **AdamW + OneCycle ‚Üí CosineWarmRestarts ‚Üí SWA** (+ EMA, AMP). –ß–µ–∫-–ø–æ–π–Ω—Ç –ø—Ä–∏ mAP‚Üë, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ SWA                         | –£—Å—Ç–æ–π—á–∏–≤—ã–π DataLoader (`num_workers=0`)   |
| **BLK-8** | –°–∫–≤–æ–∑–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è: mAP @\[0.50‚Äí0.95], @0.50, @0.75, AR @ 1/10/100                                                                 | –¢–∞–±–ª–∏—á–Ω—ã–π –≤—ã–≤–æ–¥                           |

---
## üß† –ü–æ—á–µ–º—É —Ç–∞–∫–∞—è –º–æ–¥–µ–ª—å?

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                 | –ü—Ä–∏—á–∏–Ω–∞ –≤—ã–±–æ—Ä–∞                                         |
| ------------------------- | ------------------------------------------------------ |
| **Faster R-CNN**          | –ù–∞–¥—ë–∂–Ω—ã–π –±–∞–ª–∞–Ω—Å —Ç–æ—á–Ω–æ—Å—Ç—å/—Å–∫–æ—Ä–æ—Å—Ç—å; –ª–µ–≥–∫–æ fine-tune     |
| **ResNet-50**             | –î–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –ø—Ä–∏ —É–º–µ—Ä–µ–Ω–Ω—ã—Ö FLOPs                |
| **FPN**                   | –î–µ—Ä–∂–∏—Ç –º—É–ª—å—Ç–∏-—Å–∫–µ–π–ª: —Ñ–æ–ª –º–æ–∂–µ—Ç –±—ã—Ç—å –∫—Ä—É–ø–Ω—ã–º –∏–ª–∏ –º–µ–ª–∫–∏–º |
| **AdamW + OneCycle**      | –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–≥—Ä–µ–≤ –∏ –ø–ª–∞–≤–Ω—ã–π —Å–ø–∞–¥ LR                      |
| **SWA + EMA**             | –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ —Å–Ω–∏–∂–∞–µ—Ç —à—É–º –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —à–∞–≥–æ–≤ ‚Äì + mAP         |
| **AMP**                   | \~√ó1.5 —Å–∫–æ—Ä–æ—Å—Ç—å, ‚àí40 % VRAM                            |
| **WeightedRandomSampler** | –ö–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç –∫–ª–∞—Å—Å-–¥–∏—Å–±–∞–ª–∞–Ω—Å (¬´—Ñ–æ–Ω¬ª >> ¬´foul¬ª)         |



---

## üõ†Ô∏è Hyper-Parameters

| –ü–∞—Ä–∞–º–µ—Ç—Ä            |        –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ                |
| ------------------- | --------------: | ----------------------- |
| `EPOCHS`            |              30 | –ü–æ–ª–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ         |
| `PHASE1` / `PHASE2` |         10 / 20 | OneCycle ‚Üí Cosine       |
| `swa_start`         |              25 | –°—Ç–∞—Ä—Ç SWA               |
| `batch_size`        |               4 | –î–ª—è 12 GB VRAM          |
| `IMG_SIZE`          | 512 ‚Üí 384 ‚Üí 512 | –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ |
| `lr`                |           1 e-3 | –ë–∞–∑–æ–≤—ã–π LR              |
| `weight_decay`      |           1 e-4 | –†–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è           |
| `EMA_DECAY`         |          0.9999 | ¬´–ò–Ω–µ—Ä—Ü–∏—è¬ª EMA           |
| `num_workers`       |         0 (‚Üí 2) | –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å ‚Üí —Å–∫–æ—Ä–æ—Å—Ç—å |


---
## üóÇÔ∏è –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

| –§–∞–π–ª                                  | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ                                       |
| ------------------------------------- | ------------------------------------------------ |
| `checkpoints/best_detector.pth`       | –í–µ—Å–∞ —Å –Ω–∞–∏–ª—É—á—à–∏–º mAP\@0.50 (—Å–æ—Ö—Ä. –∫–∞–∂–¥—ã–µ 5 —ç–ø–æ—Ö) |
| `checkpoints/swa_final.pth`           | –ò—Ç–æ–≥–æ–≤–∞—è SWA-—É—Å—Ä–µ–¥–Ω—ë–Ω–Ω–∞—è –º–æ–¥–µ–ª—å                  |
| `train_videos.txt` / `val_videos.txt` | –°–ø–∏—Å–∫–∏ —Ä–æ–ª–∏–∫–æ–≤ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏             |
| `seen_videos.txt`                     | –í–∏–¥–µ–æ, —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ—à–ª—ã—Ö –∑–∞–ø—É—Å–∫–∞—Ö     |
